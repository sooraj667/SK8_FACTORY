{% extends 'store/userdashboard/loggedin.html' %}

{% block style %}
 {% comment %} container-fluid {
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
    padding: 20px;
  } {% endcomment %}

  h1 {
    text-align: center;
    color: #333;
  }

  .formcont {
    max-width: 400px;
    margin: 0 auto;
    background-color: #fff;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }

  label {
    display: block;
    margin-bottom: 5px;
    color: #555;
  }

  input[type="text"],
  input[type="email"] {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    margin-bottom: 20px;
  }

  input[type="submit"] {
    background-color: #4CAF50;
    color: #fff;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
  }

  input[type="submit"]:hover {
    background-color: #45a049;
  } 





{% comment %} table styling {% endcomment %}
  h1 {
    text-align: center;
    color: #333;
  }

  {% comment %} .container {
    max-width: 800px;
    margin: 0 auto;
    background-color: #fff;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  } {% endcomment %}

  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }

  th, td {
    padding: 8px;
    text-align: left;
    border-bottom: 1px solid #ddd;
  }

  th {
    background-color: #f2f2f2;
    color: #333;
  }

  .button-container {
    display: flex;
    justify-content: flex-end;
  }

  .button-container button {
    margin-left: 10px;
    background-color: #4CAF50;
    color: #fff;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  .button-container button:hover {
    background-color: #45a049;
  }


{% endblock style %}






{% block content %}
<br><br><br><br><br><br>


 <div class="container">
    <div class="row">
        <div class="col-md-4 border border-1">


            <div class="container formcont">
                <h1 class="block1-name ltext-102 trans-04 p-b-8">Your Details</h1>
                <div >
                    <label  for="name">Username:</label>
                    <span class="ml-5" id="name">{{username}}</span>
                  </div>


                <div class="mt-3" >
                  <label  for="name">Name:</label>
                  <span class="ml-5" id="name">{{customerobj.name}}</span>
                </div>
              
                <div class="mt-3">
                  <label for="email">Email:</label>
                  <span class="ml-5" id="email">{{customerobj.email}}</span>
                </div>

                <div class="mt-3">
                    <label for="email">Phone Number:</label>
                    <span class="ml-5" id="email">{{customerobj.phonenumber}}</span>
                  </div>
                  
                  <button class="flex-c-m stext-101 cl0 btn bg1 bor1 hov-btn1 p-lr-15 trans-04  mt-3"  data-bs-toggle="modal" data-bs-target="#editdata-{{forloop.counter}}" > Edit Details</button>

                  
                  
                  



            
              
                  
              </div>
              




            {% comment %} <div class="container formcont ">
                <h1 class="block1-name ltext-102 trans-04 p-b-8">Edit User Details</h1>
                <form>
                  <label for="name">Name</label>
                  <input type="text" id="name" name="name" placeholder="Enter your name" required>
            
                  <label  for="email">Email</label>
                  <input type="email" id="email" name="email" placeholder="Enter your email" required>
            
                  <input type="submit" value="Save Changes">
                </form>
              </div> {% endcomment %}

              <div>
                

              </div>

        </div>

        

        {% comment %} Edit User Details Modal {% endcomment %}

        <div class="modal fade mt-5" id="editdata-{{forloop.counter}}" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="editModalLabel">Edit User Details</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <!-- Your form elements go here -->
                  <form action={% url 'edituserdetails' %} method="POST"> {% csrf_token %}
                    

                    <label for="name">Name</label>
                    <input value={{customerobj.name}} type="text" id="name" name="name" placeholder="Enter your name" required>
          
                    <label for="email">Email</label>
                    <input value={{customerobj.email}} type="email" id="email" name="email" placeholder="Enter your email" required>

                    <label for="">Phonenumber</label>
                    <input value={{customerobj.phonenumber}} type="number" id="email" name="phonenumber" placeholder="Enter your phonumber" required>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                  </form>
                </div>
                
                  
                
              </div>
            </div>
          </div>







        <div class="col-md-8 border border-1">

            <div class="container">
                <div class="row">
                    <span class="block1-name ltext-102 trans-04 p-b-8 mt-3">
                        Your Orders
                    </span>
                    <div class="row mt-5"></div>
                    <div class="row mt-5"></div>
                </div>
                <div class="row">
                    <table class="table table-striped">
                        <thead>
                          <tr>
                            <th>Product</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th>Date</th>
                            <th>Status Of Order</th>
                            <th>Image</th>
                            <th>Cancel</th>
                            
                          </tr>
                        </thead>
                        <tbody>
                          {% for item in orderobjs %}
                          {% if item.orderstatus != "ReturnRequested" %}
                          <tr>
                            <td>{{ item.product.name }}</td>
                            <td>{{ item.finalprice }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.orderdate }}</td>
                            <td>{{ item.orderstatus }}</td>
                            <td><img class="img-fluid img-thumbnail" src="{{ item.product.image1.url }}" alt="" width="50" height="50"></td>

                            {% if item.orderstatus != 'Cancelled' %}
                            <td id="orderitem{{item.id}}"><button  type="button" class="btn delete-btn btn-danger" data-category-id="{{ item.id }}">Cancel</button></td>
                            
                            {% else %}

                            <td><span class="text-danger">Order <div>Cancelled</div> </span></td>

                            
                            {% endif %}

                            {% comment %} <td>
                              <a href="{% url 'admin_editproducts' item.id %}">
                                <button class="btn edit-btn btn-warning">Edit</button>
                              </a>
                            </td>
                            <td>
                              <a href="{% url 'admin_deleteproducts' item.id %}">
                                <button class="btn delete-btn btn-danger">Delete</button>
                              </a>
                            </td> {% endcomment %}
                          </tr>
                          {% endif %}
                          {% endfor %}
                        </tbody>
                      </table>
                    
            
                </div>
                <div>
                  <a style="color:#717fe0" href={% url 'deliveredproducts' %}>Delivered Products</a>
                </div>
                
            </div>


            
               
            
            
            
            
            
            
            
            {% comment %} <div class="row mt-5"></div>
            <div class="row mt-5"></div>
            <div class="row mt-5"></div>
            <div class="row mt-5"></div> {% endcomment %}
            
            
            
            
            


        </div>





    </div>


    <div class="row mt-3">
        <div class="col-md-4 border border-1">
            <div class="mt-3">
                <label class="block1-name ltext-102 trans-04 p-b-8" for="">Your Addresses</label> 
              </div>
              
                <div>
    
                <ol>
                    {% for addressobj in addressobjs  %}
                    <li class="ml-5">
                        {{addressobj.house}} , {{addressobj.locality}} , {{addressobj.district}}
                         <div>{{addressobj.state}} , {{addressobj.country}}</div>
                         <div>Pincode : {{addressobj.pincode}}</div>
                         
                    </li>
                    

                    <button class="flex-c-m stext-101 cl0 btn bg1 bor1 hov-btn1 p-lr-15 trans-04  mt-3"  data-bs-toggle="modal" data-bs-target="#editaddress-{{forloop.counter}}" > Edit Address</button>
                    <hr>
                    {% endfor %}
                </ol>

                

    
                </div>
                {% comment %} <button class="btn btn-warning mt-3"  data-bs-toggle="modal" data-bs-target="#editaddress-{{forloop.counter}}" > Edit Address</button> {% endcomment %}
        </div>
    </div>
</div> 

{% comment %} Edit Address Modal {% endcomment %}
{% for addressobj  in addressobjs  %}
<div class="modal fade mt-5" id="editaddress-{{forloop.counter}}" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">Edit User Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Your form elements go here -->
        <form action={% url 'edituseraddress' addressobj.id %}  method="POST"> {% csrf_token %}
          

          <label for="name">House</label>
          <input value={{addressobj.house}} type="text" id="name" name="house" placeholder="Enter your name" required>

          <label for="email">Locality</label>
          <input value={{addressobj.locality}} type="text" id="email" name="locality" placeholder="Enter your email" required>

          <label for="">District</label>
          <input value={{addressobj.district}} type="text" id="email" name="district" placeholder="Enter your phonumber" required>

          <label for="">State</label>
          <input value={{addressobj.state}} type="text" id="email" name="state" placeholder="Enter your phonumber" required>

          <label for="">Country</label>
          <input value={{addressobj.country}} type="text" id="email" name="country" placeholder="Enter your phonumber" required>

          <label for="">Pin Code</label>
          <input value={{addressobj.pincode}} type="number" id="email" name="pincode" placeholder="Enter your phonumber" required>
          <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
      
        
      
    </div>
  </div>
  </div>

  {% endfor %}

<br><br><br><br><br><br>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js" integrity="sha512-pumBsjNRGGqkPzKHndZMaAG+bir374sORyzM3uulLV14lN5LyykqNk8eEeUlUkB3U0M4FApyaHraT65ihJhDpQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


            {% comment %} <script>
            
              $(".delete-btn").click(function() {
                var someid  = $(this).data("category-id");
                if (confirm("Are you sure you want to cancel this order?")) {
                    
                    $.ajax({
                        url: "../cancelorder/" + someid ,
                        type: "GET",
                        beforeSend: function(xhr) {
                          xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
                        },
                        success: function(response) {
                            alert(response.message);
                            location.reload();
                        },
                        error: function(xhr, status, error) {
                            alert("Error: " + error);
                        }
                    });
                }
            });  
            </script> {% endcomment %}



      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js" integrity="sha512-pumBsjNRGGqkPzKHndZMaAG+bir374sORyzM3uulLV14lN5LyykqNk8eEeUlUkB3U0M4FApyaHraT65ihJhDpQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
            <script>
             $(document).ready(function() {
                 $(".delete-btn").click(function() {
                   var orderid = $(this).data("category-id");
                     // Get the selected offer value
                   
                   // Send an AJAX request to update the offer price
                   $.ajax({
                     url: "../cancelorder/" + orderid, // Replace with the URL of your Django view
                     type: "GET",
                     data: { offer: orderid,
                             
                             
                         },
                     success: function(response) {
                       //$("#offer" + orderid).remove();
                       // Update the offer price on the page
                       var content = response.content;  // Assuming the response contains the updated offer price
                       // Update the appropriate HTML element with the new offer price
                       $("#orderitem" + orderid).text("Cancelled").addClass("text-danger");;
                       alert(response.message);
                     },
                     error: function(xhr, errmsg, err) {
                       // Handle any errors that occur during the AJAX request
                       console.log(xhr.status + ": " + xhr.responseText);
                     }
                   });
                 });
               });
             </script>


{% endblock content %}






<div class="btn-group dropend">
    <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
      Dropend
    </button>
    <ul class="dropdown-menu">
      <li><a class="dropdown-item" href="#">Menu item</a></li>
      <li><a class="dropdown-item" href="#">Menu item</a></li>
      <li><a class="dropdown-item" href="#">Menu item</a></li>
    </ul>
  </div>



