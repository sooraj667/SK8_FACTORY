{% extends 'store/userdashboard/loggedin.html' %}

{% block style %}
 {% comment %} container-fluid {
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
    padding: 20px;
  } {% endcomment %}

  h1 {
    text-align: center;
    color: #333;
  }

  .formcont {
    max-width: 400px;
    margin: 0 auto;
    background-color: #fff;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }

  label {
    display: block;
    margin-bottom: 5px;
    color: #555;
  }

  input[type="text"],
  input[type="email"] {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    margin-bottom: 20px;
  }

  input[type="submit"] {
    background-color: #4CAF50;
    color: #fff;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
  }

  input[type="submit"]:hover {
    background-color: #45a049;
  } 





{% comment %} table styling {% endcomment %}
  h1 {
    text-align: center;
    color: #333;
  }

  {% comment %} .container {
    max-width: 800px;
    margin: 0 auto;
    background-color: #fff;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  } {% endcomment %}

  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }

  th, td {
    padding: 8px;
    text-align: left;
    border-bottom: 1px solid #ddd;
  }

  th {
    background-color: #f2f2f2;
    color: #333;
  }

  .button-container {
    display: flex;
    justify-content: flex-end;
  }

  .button-container button {
    margin-left: 10px;
    background-color: #4CAF50;
    color: #fff;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  .button-container button:hover {
    background-color: #45a049;
  }


{% endblock style %}






{% block content %}

{% comment %} <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css"> {% endcomment %}
{% comment %} <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>  {% endcomment %}





<br><br><br><br><br><br>


 <div class="container">
  <div class="dropdown ">
    <button class="btn  dropdown-toggle stext-101 cl0  bg1  hov-btn2 p-lr-15 trans-04 mt-3" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      More
    </button>
    <div class="dropdown-menu " aria-labelledby="dropdownMenuButton">
      <a class="dropdown-item" href={% url 'wallet' %}> 
         <div class="" style="color:#717fe0;">
           <i class="fas fa-wallet"></i> <span style="color:black;">Your wallet</span>
         </div>
      </a>
      <a style="color:#717fe0" class="dropdown-item" href={% url 'deliveredproducts' %}>
        <div>
          <i class="bi bi-basket"></i>

          <i style="color:#717fe0" class="fas fa-shopping-cart"></i> <span style="color:black;">Delivered Products</span>
        </div>
      </a>
      
    </div>
  </div>
  <br>
  


  
    <div class="row">
        <div class="col-md-4 border border-1">
         


            <div class="container formcont">
                <h1 class="block1-name ltext-102 trans-04 p-b-8">Your Details</h1>
                <div >
                    <label  for="name">Username:</label>
                    <span class="ml-5" id="name">{{username}}</span>
                  </div>


                <div class="mt-3" >
                  <label  for="name">Name:</label>
                  <span class="ml-5" id="name">{{customerobj.name}}</span>
                </div>
              
                <div class="mt-3">
                  <label for="email">Email:</label>
                  <span class="ml-5" id="email">{{customerobj.email}}</span>
                </div>

                <div class="mt-3">
                    <label for="email">Phone Number:</label>
                    <span class="ml-5" id="email">{{customerobj.phonenumber}}</span>
                </div>
                  
                  <button class="flex-c-m stext-101 cl0 size-103 bg1 bor1 hov-btn2 p-lr-15 trans-04 mt-3"  data-bs-toggle="modal" data-bs-target="#editdata-{{forloop.counter}}" > Edit Details</button>

                  
                  
                  



            
              
                  
            </div>

            <div class="row mt-4 ml-1">

              <div class=" ">
                <div class="mt-3">
                   <label class="block1-name ltext-102 trans-04 p-b-8" for="">Your Addresses</label> 
                </div>
                 
                   <div>
       
                   <ol>
                       {% for addressobj in addressobjs  %}
                       <li class="ml-5">
                           {{addressobj.house}} , {{addressobj.locality}} , {{addressobj.district}}
                            <div>{{addressobj.state}} , {{addressobj.country}}</div>
                            <div>Pincode : {{addressobj.pincode}}</div>
                            
                       </li>
                       
   
                       <button class="flex-c-m stext-101 cl0 size-103 bg1 bor1 hov-btn2 p-lr-15 trans-04  mt-3"  data-bs-toggle="modal" data-bs-target="#editaddress-{{forloop.counter}}" > Edit Address</button>
                       <hr>
                       {% endfor %}
                   </ol>
   
                   
   
       
                   </div>
                   <button style="margin-left:190px;" id="addaddress" class="flex-c-m stext-101 cl0 btn bg1  hov-btn2 p-lr-15 trans-04  mt-5 text-center"  >&#43; Add New Address </button>
   
                   {% comment %} <button class="btn btn-warning mt-3"  data-bs-toggle="modal" data-bs-target="#editaddress-{{forloop.counter}}" > Edit Address</button> {% endcomment %}
           </div>



            </div>
              




            {% comment %} <div class="container formcont ">
                <h1 class="block1-name ltext-102 trans-04 p-b-8">Edit User Details</h1>
                <form>
                  <label for="name">Name</label>
                  <input type="text" id="name" name="name" placeholder="Enter your name" required>
            
                  <label  for="email">Email</label>
                  <input type="email" id="email" name="email" placeholder="Enter your email" required>
            
                  <input type="submit" value="Save Changes">
                </form>
              </div> {% endcomment %}

              <div>
                

              </div>

        </div>

        

        {% comment %} Edit User Details Modal {% endcomment %}

        <div class="modal fade mt-5" id="editdata-{{forloop.counter}}" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
          <br><br><br>
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="editModalLabel">Edit User Details</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <!-- Your form elements go here -->
                  <form action={% url 'edituserdetails' %} method="POST"> {% csrf_token %}
                    

                    <label for="name">Name</label>
                    <input value={{customerobj.name}} type="text" id="name" name="name" placeholder="Enter your name" required>
          
                    <label for="email">Email</label>
                    <input value={{customerobj.email}} type="email" id="email" name="email" placeholder="Enter your email" required>

                    <label for="">Phonenumber</label>
                    <input value={{customerobj.phonenumber}} type="number" id="email" name="phonenumber" placeholder="Enter your phonumber" required>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="flex-c-m stext-101 cl0 size-103 bg1 bor1 hov-btn2 p-lr-15 trans-04">Save Changes</button>
                    </div>
                  </form>
                </div>
                
                  
                
              </div>
            </div>
          </div>


          {% comment %} Add address Modal {% endcomment %}
          <div class="modal mt-5" id="addaddress_modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
              <div class="modal-content mt-5">
                <div class="modal-header">
                  <h5 class="modal-title">Add Address</h5>
                  <button type="button" class="closeit close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <!-- Address form -->
                  
                 
                    <div class="form-group">
                      <label for="housename">House Name:</label>
                      <input type="text" class="form-control" id="housename" name="housename" placeholder="Enter house name" Required>
                      <span class="text-danger" id="error_housename"></span>
                    </div>
                    <div class="form-group">
                      <label for="country">Country:</label>
                      <input type="text" class="form-control" id="countryname" name="countryname" placeholder="Enter country" Required>
                      <span class="text-danger" id="error_countryname"></span>
                    </div>
                    <div class="form-group">
                      <label for="state">State:</label>
                      <input type="text" class="form-control" id="statename" name="statename" placeholder="Enter state" Required>
                      <span class="text-danger" id="error_statename"></span>
                    </div>
                    <div class="form-group">
                      <label for="district">District:</label>
                      <input type="text" class="form-control" id="districtname" name="districtname" placeholder="Enter district" Required>
                      <span class="text-danger" id="error_districtname"></span>
                    </div>
                    <div class="form-group">
                      <label for="locality">Locality:</label>
                      <input type="text" class="form-control" id="localityname" name="localityname" placeholder="Enter locality" Required>
                      <span class="text-danger" id="error_localityname"></span>
                    </div>
                    <div class="form-group">
                      <label for="pincode">Pincode:</label>
                      <input type="text" class="form-control" id="pincodename" name="pincodename" placeholder="Enter pincode" Required>
                      <span class="text-danger" id="error_pincodename"></span>
                    </div>
                    <div class="modal-footer">
                      <button  class="btn btn-danger closeit" id="">Close</button>
                    <button  class="flex-c-m stext-101 cl0 size-103 bg1 bor1 hov-btn2 p-lr-15 trans-04" id="submitaddress">Save Address</button>

                    </div>
            
                    
                    
                 
                </div>
              </div>
            </div>
          </div>







        <div class="col-md-8 border border-1">

            <div class="container">
                
                <div class="row">
                  <span class="block1-name ltext-102 trans-04 p-b-8 mt-3">
                      Your Orders
                  </span>
                  <div class="row mt-5"></div>
                  <div class="row mt-5"></div>
              </div>

              <hr>
              <div class="row">
                  <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>Sl No</th>
                          <th>Total Price</th>
                          <th>Coupon</th>
                          <th>Order Date</th>
                          <th></th>

                      
                          
                        </tr>
                      </thead>
                      <tbody>
                        {% for item in ordernumberobjs %}
                 
                       

                          <tr onclick="window.location.href='{% url 'orderdetails' item.id %}'">
                            <td>{{ item.slno }}</td>
                            <td>{{ item.totalamount }}</td>
                            {% if item.coupon.code %}
                            <td class="text-success">{{ item.coupon.code }} Coupon Applied &#x2713; </td>
                            {% else %}
                            <td class="text-danger">No Coupon</td>  
                            {% endif %}
                            <td>{{ item.ordertime }}</td>
                            <td><a style="color:#717fe0;" class=""  href={% url 'orderdetails'  item.id  %}> View details <i class="fas fa-angle-double-right"></i>




                            </a></td>
                          </tr>
                       
                       
                        
                          
                          
                        {% endfor %}
                      </tbody>
                    </table>
                  
          
              </div>
               
                
            </div>


            
               
            
            
            
            
            
            
            
            {% comment %} <div class="row mt-5"></div>
            <div class="row mt-5"></div>
            <div class="row mt-5"></div>
            <div class="row mt-5"></div> {% endcomment %}
            
            
            
            
            


        </div>





    </div>


    
</div> 

{% comment %} Edit Address Modal {% endcomment %}
{% for addressobj  in addressobjs  %}
<div class="modal fade mt-5" id="editaddress-{{forloop.counter}}" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">Edit User Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Your form elements go here -->
        <form action={% url 'edituseraddress' addressobj.id %}  method="POST"> {% csrf_token %}
          

          <label for="name">House</label>
          <input value={{addressobj.house}} type="text" id="name" name="house" placeholder="Enter your name" required>

          <label for="email">Locality</label>
          <input value={{addressobj.locality}} type="text" id="email" name="locality" placeholder="Enter your email" required>

          <label for="">District</label>
          <input value={{addressobj.district}} type="text" id="email" name="district" placeholder="Enter your phonumber" required>

          <label for="">State</label>
          <input value={{addressobj.state}} type="text" id="email" name="state" placeholder="Enter your phonumber" required>

          <label for="">Country</label>
          <input value={{addressobj.country}} type="text" id="email" name="country" placeholder="Enter your phonumber" required>

          <label for="">Pin Code</label>
          <input value={{addressobj.pincode}} type="number" id="email" name="pincode" placeholder="Enter your phonumber" required>
          <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="flex-c-m stext-101 cl0 size-103 bg1 bor1 hov-btn2 p-lr-15 trans-04">Save Changes</button>
          </div>
        </form>
      </div>
      
        
      
    </div>
  </div>
  </div>

  {% endfor %}




  {% comment %} CANCEL MODAL {% endcomment %}
 
  <div style="margin-top:100px;" class="modal fade" id="cancelModal" tabindex="-1" role="dialog" aria-labelledby="cancelModalLabel" aria-hidden="true">
 
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cancelModalLabel">Confirm Order Cancellation</h5>
          <button type="button" class="close closeit" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to cancel this order?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary closeit" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-danger closeit" data-dismiss="modal" id="confirmcancel">Cancel Order</button>
        </div>
      </div>
    </div>
  </div>



  <div style="margin-top:100px;" class="modal fade" id="walletmodal" tabindex="-1" role="dialog" aria-labelledby="cancelModalLabel" aria-hidden="true">
 
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cancelModalLabel">Order Cancelled</h5>
          
            {% comment %} <span aria-hidden="true">&times;</span> {% endcomment %}
          </button>
        </div>
        <div class="modal-body p-5">
          <p > <h5 style="color:green;"> Amount is added to your wallet &#x2713; </h5></p>
        </div>
        {% comment %} <div class="modal-footer">
          <button type="button" class="btn btn-secondary closeit" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-danger closeit" data-dismiss="modal" id="confirmcancel">Cancel Order</button>
        </div> {% endcomment %}
      </div>
    </div>
  </div>


  <div style="margin-top:100px;" class="modal fade" id="addressconfirmmodal" tabindex="-1" role="dialog" aria-labelledby="cancelModalLabel" aria-hidden="true">
 
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cancelModalLabel">Address Added</h5>
          
            {% comment %} <span aria-hidden="true">&times;</span> {% endcomment %}
          </button>
        </div>
        <div class="modal-body p-5">
          <p > <h5 style="color:green;"> New address is addded &#x2713; </h5></p>
        </div>
        {% comment %} <div class="modal-footer">
          <button type="button" class="btn btn-secondary closeit" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-danger closeit" data-dismiss="modal" id="confirmcancel">Cancel Order</button>
        </div> {% endcomment %}
      </div>
    </div>
  </div>

<br><br><br><br><br><br>









            {% comment %} <script>
            
              $(".delete-btn").click(function() {
                var someid  = $(this).data("category-id");
                if (confirm("Are you sure you want to cancel this order?")) {
                    
                    $.ajax({
                        url: "../cancelorder/" + someid ,
                        type: "GET",
                        beforeSend: function(xhr) {
                          xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
                        },
                        success: function(response) {
                            alert(response.message);
                            location.reload();
                        },
                        error: function(xhr, status, error) {
                            alert("Error: " + error);
                        }
                    });
                }
            });  
            </script> {% endcomment %}



      
            <script>
             $(document).ready(function() {
                 $(".delete-btn").click(function() {
                   var orderid = $(this).data("category-id");
                     // Get the selected offer value
                   
                    $("#cancelModal").modal("show");
                    
                    $("#confirmcancel").click(function(){
                      $.ajax({
                        url: "../cancelorder/" + orderid, // Replace with the URL of your Django view
                        type: "GET",
                        data: { offer: orderid,
                                
                                
                            },
                        success: function(response) {
                          var walletcontent=response.walletcontent
                          //$("#offer" + orderid).remove();
                          // Update the offer price on the page
                          var content = response.content;  // Assuming the response contains the updated offer price
                          // Update the appropriate HTML element with the new offer price
                          $("#orderitem" + orderid).text("Cancelled").addClass("text-danger");
                          if (walletcontent=="added"){
                            $("#walletmodal").modal('show');
                            setTimeout(function() {
                              $("#walletmodal").modal('hide');
                            }, 1800);



                          }
                         
                          
                          
                        },
                        error: function(xhr, errmsg, err) {
                          // Handle any errors that occur during the AJAX request
                          console.log(xhr.status + ": " + xhr.responseText);
                        }
                      });









                    })
                   // Send an AJAX request to update the offer price
               
                 });

                 $(".closeit").click(function(){
                  $("#cancelModal").modal("hide");
                 })



               });
             </script>

             <script>
              $("#addaddress").click(function(){
                $("#addaddress_modal").modal('show');
                $(".closeit").click(function(){
                  $("#addaddress_modal").modal("hide");
                })
                $("#submitaddress").click(function(){
                  
                  $("#error_housename").html("")
                  $("#error_countryname").html("")
                  $("#error_statename").html("")
                  $("#error_districtname").html("")
                  $("#error_localityname").html("")
                  $("#error_pincodename").html("")
                  var house = $("#housename").val();
                  var country = $("#countryname").val();
                  var state = $("#statename").val();
                  var district = $("#districtname").val();
                  var locality = $("#localityname").val();
                  var pincode = $("#pincodename").val();
                  var error={}
                  if (house=="") {

                    $("#error_housename").html("House name can't be empty");
                  }
                  else if (house.length < 3){
          
                    $("#error_housename").html("House name should contain minimum three characters")
                  }
                  else if (country=="") {

                    $("#error_countryname").html("Country name can't be empty");
                  }
                  else if (!/^[a-zA-Z]+$/.test(country)) {

                    $("#error_countryname").html("Country name can't have numbers");
                  }
                  else if (country.length < 3) {
              
                    $("#error_countryname").html("Country name should contain minimum three characters")
                  }
                  else if (state=="") {

                    $("#error_statename").html("State name can't be empty");
                  }
                  else if (!/^[a-zA-Z]+$/.test(state)) {

                    $("#error_statename").html("State name can't have numbers");
                  }
                  else if (state.length < 3) {
      
                    $("#error_statename").html("State name should contain minimum three characters")
                  }
                  else if (district=="") {

                    $("#error_districtname").html("District name can't be empty");
                  }
                  else if (!/^[a-zA-Z]+$/.test(district)) {

                    $("#error_districtname").html("District name can't have numbers");
                  }
               
                  else if (district.length < 3) {
                  
                    $("#error_districtname").html("District name should contain minimum three characters")
                  }
                  else if (locality=="") {

                    $("#error_localityname").html("Locality name can't be empty");
                  }
                  else if (!/^[a-zA-Z]+$/.test(locality)) {

                    $("#error_localityname").html("Locality name can't have numbers");
                  }
                  else if (locality.length < 3) {
                  
                    $("#error_localityname").html("Locality name should contain minimum three characters")
                  }
                  else if (pincode=="") {

                    $("#error_pincodename").html("Pincode name can't be empty");
                  }
                  else if (isNaN(pincode) || pincode.length !== 6) {
                    $("#error_pincodename").html("Invalid Pincode")
                  }
                  else{
                   
                    $.ajax({
                      url:"/addaddress/",
                      type:"GET",
                      data:{
                        house:house,
                        country:country,
                        state:state,
                        district:district,
                        locality:locality,
                        pincode:pincode
                      },
                      success:function(response){
                        $("#addaddress_modal").modal('hide');
                      
                        $("#addressconfirmmodal").modal('show');
                            setTimeout(function() {
                              $("#addressconfirmmodal").modal('hide');
                              window.location.href="/userprofile/";
                            }, 1800);
                          
                        
                        
                      },
                      error: function(xhr, errmsg, err) {
                       
                        console.log(xhr.status + ": " + xhr.responseText);
                      }
      

                    })

                  }
                 
                   
                      
  
  
                   




             
                  
                })
          



              })
             </script>


{% endblock content %}






<div class="btn-group dropend">
    <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
      Dropend
    </button>
    <ul class="dropdown-menu">
      <li><a class="dropdown-item" href="#">Menu item</a></li>
      <li><a class="dropdown-item" href="#">Menu item</a></li>
      <li><a class="dropdown-item" href="#">Menu item</a></li>
    </ul>
  </div>



